<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Amir A. Seid">
<meta name="dcterms.date" content="2026-02-09">

<title>Heart_failure</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Heart_failure_files/libs/clipboard/clipboard.min.js"></script>
<script src="Heart_failure_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Heart_failure_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Heart_failure_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="Heart_failure_files/libs/quarto-html/popper.min.js"></script>
<script src="Heart_failure_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Heart_failure_files/libs/quarto-html/anchor.min.js"></script>
<link href="Heart_failure_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Heart_failure_files/libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Heart_failure_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Heart_failure_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Heart_failure_files/libs/bootstrap/bootstrap-4d7f0bce1131f3e5f9547cd857cfbfc8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="Heart_failure_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="Heart_failure_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">



</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#building-a-prediction-model-for-coronary-artery-disease" id="toc-building-a-prediction-model-for-coronary-artery-disease" class="nav-link active" data-scroll-target="#building-a-prediction-model-for-coronary-artery-disease"><span class="header-section-number">1</span> Building a Prediction Model for Coronary Artery Disease</a>
  <ul class="collapse">
  <li><a href="#abstract" id="toc-abstract" class="nav-link" data-scroll-target="#abstract"><span class="header-section-number">1.1</span> Abstract</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">1.2</span> Introduction:</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods"><span class="header-section-number">1.3</span> Methods</a>
  <ul class="collapse">
  <li><a href="#presented-variables" id="toc-presented-variables" class="nav-link" data-scroll-target="#presented-variables"><span class="header-section-number">1.3.1</span> Presented Variables:</a></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning"><span class="header-section-number">1.3.2</span> <strong>Data Cleaning</strong></a></li>
  <li><a href="#handling-missing-values." id="toc-handling-missing-values." class="nav-link" data-scroll-target="#handling-missing-values."><span class="header-section-number">1.3.3</span> <strong>Handling Missing Values.</strong></a></li>
  <li><a href="#building-a-regression-model" id="toc-building-a-regression-model" class="nav-link" data-scroll-target="#building-a-regression-model"><span class="header-section-number">1.3.4</span> <strong>Building a Regression Model</strong></a></li>
  <li><a href="#tools" id="toc-tools" class="nav-link" data-scroll-target="#tools"><span class="header-section-number">1.3.5</span> Tools</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">1.4</span> Results</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion"><span class="header-section-number">1.5</span> Discussion</a></li>
  <li><a href="#reference" id="toc-reference" class="nav-link" data-scroll-target="#reference"><span class="header-section-number">1.6</span> Reference:</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Heart_failure.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="Heart_failure.docx"><i class="bi bi-file-word"></i>MS Word</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Heart_failure</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Amir A. Seid </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 9, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="building-a-prediction-model-for-coronary-artery-disease" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Building a Prediction Model for Coronary Artery Disease</h1>
<section id="abstract" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="abstract"><span class="header-section-number">1.1</span> Abstract</h2>
<p><strong>Methodology</strong>: This study uses the UCI Heart Disease repository to develop a predictive framework for Coronary Artery Disease (CAD). Python 3.14 was used for data preparation and R 4.5.2for the analysis. Partial Proportional Odds (PPO) model was used to respect ordinal disease severity (Classes 0–4) after variables failed the parallel lines assumption. Missing values were addressed via MICE with specialized logistic regressions, and coefficients were pooled using Rubin’s Rules. A Bayesian-inspired weighting strategy was applied to minimize systemic bias and prioritize clinical safety over raw accuracy.</p>
<p><strong>Results</strong>: The binary model demonstrated clinical viability with an accuracy of 56% and a balanced accuracy of 84.2% . While the unweighted model achieved a sensitivity of 85% and specificity of 83%, the multinomial version struggled with rare severity stages (Classes 2 and 4). The weighting strategy achieved a 51.5% (from 0.33 to 0.17) reduction in systemic bias, successfully trading absolute success rate for the higher sensitivity required in diagnostic screening.</p>
</section>
<section id="introduction" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1.2</span> Introduction:</h2>
<p>Coronary Artery Disease (CAD) remains the leading cause of global mortality, accounting for an estimated 17.8 million deaths annually. Epidemiological trends indicate a shifting burden; while mortality rates have stabilized in high-income countries due to advanced interventions, the prevalence of CAD is surging in developing regions and among younger populations. This “epidemiological transition” presents a critical challenge: the sheer volume of patients at risk is outpacing the availability of specialized diagnostic resources, such as coronary angiography.</p>
<p>Traditional clinical risk scores often struggle with the non-linear complexity of biological data. Machine Learning models have been tuned for accuracy and have extended to include the nuanced and unpredictable nature of medicine. By using the famous data sets, the UCI Cleveland Heart Disease repository, we developed an ML model that can identify patterns hard to check with standard diagnostic methods. Many traditional models collapse the target variable into a binary. In contrary, we respected the ordinal nature of our target variable to consider the nuances. Since three of our variables (age, sex, and exercise-induced angina) couldn’t meet parallel line assumptions, Partial Proportional Odds (PPO) was preferred in the model. The model achieved a binary accuracy of 85% (Healthy vs Sick) and a mean predictive difference of 0.59, showing the model errors tend to fall to the most correct value. While the UCI Heart Disease data is the benchmark in the application of machine learning in healthcare, we believe this report sheds light on a predictive framework to provide actionable diagnostic foresight to clinicians.</p>
</section>
<section id="methods" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="methods"><span class="header-section-number">1.3</span> Methods</h2>
<p>The infamous UCI Heart Disease data, usually considered a benchmark for applying data science in healthcare, was used for the analysis. The four databases are Cleveland, Switzerland, VA, and Hungarian data sets. These data sets were pooled and merged using Python 3.</p>
<section id="presented-variables" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="presented-variables"><span class="header-section-number">1.3.1</span> Presented Variables:</h3>
<p>The merged csv data had 14 variables (13 features and 1 target variable)</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-bordered table-condensed lightable-classic caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variables</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">datatypes</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">feature/target</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">explanation</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Missing Value (in%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ca</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">feature</td>
<td style="text-align: left;">Number of major vessels (0-3) colored by flourosopy</td>
<td style="text-align: left;">66%</td>
</tr>
<tr class="even">
<td style="text-align: left;">thal</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">feature</td>
<td style="text-align: left;">Thalassemia (3 = normal; 6 = fixed defect; 7 = reversable defect)</td>
<td style="text-align: left;">53%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">slope</td>
<td style="text-align: left;">ordered, factor</td>
<td style="text-align: left;">feature</td>
<td style="text-align: left;">The slope of the peak exercise ST segment</td>
<td style="text-align: left;">34%</td>
</tr>
<tr class="even">
<td style="text-align: left;">fbs</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">feature</td>
<td style="text-align: left;">Fasting blood sugar &gt; 120 mg/dl (1 = true; 0 = false)</td>
<td style="text-align: left;">10%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">oldpeak</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">feature</td>
<td style="text-align: left;">ST depression induced by exercise relative to rest</td>
<td style="text-align: left;">7%</td>
</tr>
<tr class="even">
<td style="text-align: left;">trestbps</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">feature</td>
<td style="text-align: left;">Resting blood pressure (in mm Hg on admission)</td>
<td style="text-align: left;">6%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">thalach</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">feature</td>
<td style="text-align: left;">Maximum heart rate achieved</td>
<td style="text-align: left;">6%</td>
</tr>
<tr class="even">
<td style="text-align: left;">exang</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">feature</td>
<td style="text-align: left;">Exercise induced angina (1 = yes; 0 = no)</td>
<td style="text-align: left;">6%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">chol</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">feature</td>
<td style="text-align: left;">Serum cholestoral in mg/dl</td>
<td style="text-align: left;">3%</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">feature</td>
<td style="text-align: left;">Age in years</td>
<td style="text-align: left;">0%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">feature</td>
<td style="text-align: left;">Sex (1 = male; 0 = female)</td>
<td style="text-align: left;">0%</td>
</tr>
<tr class="even">
<td style="text-align: left;">cp</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">feature</td>
<td style="text-align: left;">Chest pain type (1: typical, 2: atypical, 3: non-anginal, 4: asymptomatic)</td>
<td style="text-align: left;">0%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">restecg</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">feature</td>
<td style="text-align: left;">Resting electrocardiographic results</td>
<td style="text-align: left;">0%</td>
</tr>
<tr class="even">
<td style="text-align: left;">num</td>
<td style="text-align: left;">ordered, factor</td>
<td style="text-align: left;">target</td>
<td style="text-align: left;">Diagnosis of heart disease (angiographic disease status)</td>
<td style="text-align: left;">0%</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="data-cleaning" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="data-cleaning"><span class="header-section-number">1.3.2</span> <strong>Data Cleaning</strong></h3>
<p>After skimming for the soundness of the values in our data, we converted our features from characters to their intended types of variables: Nominal, Ordinal, and Numerical. NA value representation was then handled according to the dataset description ( -9 and ?). We also assumed “0” as missing data in cholesterol.</p>
<p>Four variables,</p>
<ol type="1">
<li>thalassemia type<br>
</li>
<li>number of major blood vessels as seen by coronary angiography, an expensive process that can be difficult to apply to every patient.<br>
</li>
<li>Slope of the peak exercise ST segment<br>
</li>
<li>Cholesterol – there is an unbalanced lack of data in “Switzerland.data”.</li>
</ol>
<p>These variables were excluded due to the significant amount of missing data they contained.<br>
120 observations for the test set and 800 observations for the training set were then selected randomly.</p>
</section>
<section id="handling-missing-values." class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="handling-missing-values."><span class="header-section-number">1.3.3</span> <strong>Handling Missing Values.</strong></h3>
<p>For restecg (Resting ECG), missing values were negligible (XX%), so we imputed the mode 0.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Heart_failure_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The other feature variables undergo MICE (Multivariate Imputation Chain Equation) after we checked for a sensibly balanced distribution of all our remaining categorical and numerical features using plots, and confirmed that we can use all remaining columns.</p>
<p>Categorical Variables</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Heart_failure_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Numerical Variables</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Heart_failure_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We did two MICE imputations: one using PMM - Predictive Mean Matching and Random Forests when fitting, and the other using PMM and specialized Logistic Regressions: Logistic regression (for binary), POLR (for ordinal features), and POLYREG (for categorical features).</p>
<p>We compared two imputation methods using:</p>
<ol type="1">
<li>Density plot: to check similarity in the distribution of our five imputations,<br>
</li>
<li>Strip plots: to test if it gives a valid output.<br>
</li>
<li>Trace plots: to analyze the difference in mean and standard deviation for each loopXX.<br>
</li>
<li>Selected columns: we take the difference between the real value and the imputed value for two selected columns.</li>
</ol>
<p>And we chose the MICE model which uses specialized logistic regressions.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Heart_failure_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Heart_failure_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="building-a-regression-model" class="level3" data-number="1.3.4">
<h3 data-number="1.3.4" class="anchored" data-anchor-id="building-a-regression-model"><span class="header-section-number">1.3.4</span> <strong>Building a Regression Model</strong></h3>
<p>While we planned to use a proportional odds logistic regression model (POLR), three of our feature variables, age, sex and exang, failed to meet the Brant test for the Parallel Lines Assumption to proceed with POLR.<br>
</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-bordered table-condensed lightable-classic caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">X2</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">probability</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Omnibus</td>
<td style="text-align: left;">79.9423104</td>
<td style="text-align: left;">36</td>
<td style="text-align: left;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: left;">6.5843225</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">0.09</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex1</td>
<td style="text-align: left;">2.7320300</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">0.43</td>
</tr>
<tr class="even">
<td style="text-align: left;">cp2</td>
<td style="text-align: left;">0.3413144</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">0.95</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cp3</td>
<td style="text-align: left;">0.8620800</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">0.83</td>
</tr>
<tr class="even">
<td style="text-align: left;">cp4</td>
<td style="text-align: left;">1.4067443</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">0.70</td>
</tr>
<tr class="odd">
<td style="text-align: left;">trestbps</td>
<td style="text-align: left;">2.6273437</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">0.45</td>
</tr>
<tr class="even">
<td style="text-align: left;">fbs1</td>
<td style="text-align: left;">1.9471604</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">0.58</td>
</tr>
<tr class="odd">
<td style="text-align: left;">restecg1</td>
<td style="text-align: left;">3.5628397</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">0.31</td>
</tr>
<tr class="even">
<td style="text-align: left;">restecg2</td>
<td style="text-align: left;">7.0017508</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">0.07</td>
</tr>
<tr class="odd">
<td style="text-align: left;">thalach</td>
<td style="text-align: left;">5.3177306</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">0.15</td>
</tr>
<tr class="even">
<td style="text-align: left;">exang1</td>
<td style="text-align: left;">14.2963833</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">oldpeak</td>
<td style="text-align: left;">4.1961999</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">0.24</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The plots …</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Heart_failure_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Therefore, we chose the Partial Proportional Logistic regression model. This model doesn’t assume for homoscedacity or Parallel assumption tests, and is one of the most flexible regression models. However, feature variables that fit many of the statistical assumptions yield better accuracy than their counterparts.</p>
<p>We build our model by fitting all our imputed datasets. We also used Rubin’s Rule to pool our test model and check if our model is not just random noise using the total variance and the Z-score</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept):1 (Intercept):2 (Intercept):3 (Intercept):4         age:1 
  1.093778948   3.980227324   4.085424440   3.344427211  -2.425581054 
        age:2         age:3         age:4          sex1           cp2 
 -4.678326843  -3.335065648  -1.282744966  -5.385122343   2.442607369 
          cp3           cp4      trestbps          fbs1    restecg1:1 
  0.128781368  -2.836136622   0.357001993  -1.935239808  -1.155086961 
   restecg1:2    restecg1:3    restecg1:4    restecg2:1    restecg2:2 
 -3.098745954  -2.087068948  -0.973779131   0.093265018  -1.893010113 
   restecg2:3    restecg2:4       thalach      exang1:1      exang1:2 
 -2.764923900  -2.354069551   3.590211333  -4.024988280   0.005065197 
     exang1:3      exang1:4       oldpeak 
  0.015017842   0.852190139  -6.891312462 </code></pre>
</div>
<div class="cell-output-display">
<table class="table table-striped table-bordered table-condensed lightable-classic caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Parameters</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Total Variance</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">degree of freedom</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Margin of Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept):1</td>
<td style="text-align: left;">1.2982422</td>
<td style="text-align: left;">171</td>
<td style="text-align: left;">2.2491089</td>
</tr>
<tr class="even">
<td style="text-align: left;">(Intercept):2</td>
<td style="text-align: left;">1.3717221</td>
<td style="text-align: left;">202</td>
<td style="text-align: left;">2.3093563</td>
</tr>
<tr class="odd">
<td style="text-align: left;">(Intercept):3</td>
<td style="text-align: left;">1.6631494</td>
<td style="text-align: left;">167</td>
<td style="text-align: left;">2.5460820</td>
</tr>
<tr class="even">
<td style="text-align: left;">(Intercept):4</td>
<td style="text-align: left;">3.5240047</td>
<td style="text-align: left;">468</td>
<td style="text-align: left;">3.6888494</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age:1</td>
<td style="text-align: left;">0.0001217</td>
<td style="text-align: left;">681</td>
<td style="text-align: left;">0.0216648</td>
</tr>
<tr class="even">
<td style="text-align: left;">age:2</td>
<td style="text-align: left;">0.0001450</td>
<td style="text-align: left;">732</td>
<td style="text-align: left;">0.0236375</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age:3</td>
<td style="text-align: left;">0.0002120</td>
<td style="text-align: left;">686</td>
<td style="text-align: left;">0.0285881</td>
</tr>
<tr class="even">
<td style="text-align: left;">age:4</td>
<td style="text-align: left;">0.0007335</td>
<td style="text-align: left;">771</td>
<td style="text-align: left;">0.0531645</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex1</td>
<td style="text-align: left;">0.0477894</td>
<td style="text-align: left;">762</td>
<td style="text-align: left;">0.4291450</td>
</tr>
<tr class="even">
<td style="text-align: left;">cp2</td>
<td style="text-align: left;">0.1731850</td>
<td style="text-align: left;">723</td>
<td style="text-align: left;">0.8170165</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cp3</td>
<td style="text-align: left;">0.1396490</td>
<td style="text-align: left;">502</td>
<td style="text-align: left;">0.7342016</td>
</tr>
<tr class="even">
<td style="text-align: left;">cp4</td>
<td style="text-align: left;">0.1280772</td>
<td style="text-align: left;">514</td>
<td style="text-align: left;">0.7030850</td>
</tr>
<tr class="odd">
<td style="text-align: left;">trestbps</td>
<td style="text-align: left;">0.0000162</td>
<td style="text-align: left;">611</td>
<td style="text-align: left;">0.0079084</td>
</tr>
<tr class="even">
<td style="text-align: left;">fbs1</td>
<td style="text-align: left;">0.0384195</td>
<td style="text-align: left;">711</td>
<td style="text-align: left;">0.3848253</td>
</tr>
<tr class="odd">
<td style="text-align: left;">restecg1:1</td>
<td style="text-align: left;">0.0653273</td>
<td style="text-align: left;">757</td>
<td style="text-align: left;">0.5017535</td>
</tr>
<tr class="even">
<td style="text-align: left;">restecg1:2</td>
<td style="text-align: left;">0.0564539</td>
<td style="text-align: left;">730</td>
<td style="text-align: left;">0.4664616</td>
</tr>
<tr class="odd">
<td style="text-align: left;">restecg1:3</td>
<td style="text-align: left;">0.0777318</td>
<td style="text-align: left;">666</td>
<td style="text-align: left;">0.5474413</td>
</tr>
<tr class="even">
<td style="text-align: left;">restecg1:4</td>
<td style="text-align: left;">0.2986341</td>
<td style="text-align: left;">760</td>
<td style="text-align: left;">1.0727783</td>
</tr>
<tr class="odd">
<td style="text-align: left;">restecg2:1</td>
<td style="text-align: left;">0.0539111</td>
<td style="text-align: left;">771</td>
<td style="text-align: left;">0.4557951</td>
</tr>
<tr class="even">
<td style="text-align: left;">restecg2:2</td>
<td style="text-align: left;">0.0564092</td>
<td style="text-align: left;">753</td>
<td style="text-align: left;">0.4662532</td>
</tr>
<tr class="odd">
<td style="text-align: left;">restecg2:3</td>
<td style="text-align: left;">0.0761729</td>
<td style="text-align: left;">725</td>
<td style="text-align: left;">0.5418435</td>
</tr>
<tr class="even">
<td style="text-align: left;">restecg2:4</td>
<td style="text-align: left;">0.2528393</td>
<td style="text-align: left;">762</td>
<td style="text-align: left;">0.9870990</td>
</tr>
<tr class="odd">
<td style="text-align: left;">thalach</td>
<td style="text-align: left;">0.0000144</td>
<td style="text-align: left;">86</td>
<td style="text-align: left;">0.0075362</td>
</tr>
<tr class="even">
<td style="text-align: left;">exang1:1</td>
<td style="text-align: left;">0.0491118</td>
<td style="text-align: left;">245</td>
<td style="text-align: left;">0.4365076</td>
</tr>
<tr class="odd">
<td style="text-align: left;">exang1:2</td>
<td style="text-align: left;">0.0441734</td>
<td style="text-align: left;">483</td>
<td style="text-align: left;">0.4129697</td>
</tr>
<tr class="even">
<td style="text-align: left;">exang1:3</td>
<td style="text-align: left;">0.0682185</td>
<td style="text-align: left;">137</td>
<td style="text-align: left;">0.5164788</td>
</tr>
<tr class="odd">
<td style="text-align: left;">exang1:4</td>
<td style="text-align: left;">0.2073441</td>
<td style="text-align: left;">232</td>
<td style="text-align: left;">0.8971507</td>
</tr>
<tr class="even">
<td style="text-align: left;">oldpeak</td>
<td style="text-align: left;">0.0060177</td>
<td style="text-align: left;">135</td>
<td style="text-align: left;">0.1534168</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="tools" class="level3" data-number="1.3.5">
<h3 data-number="1.3.5" class="anchored" data-anchor-id="tools"><span class="header-section-number">1.3.5</span> Tools</h3>
<p>Python 3.14 was used for primary data preparation, and R 4.5.2 was used for the analysis.</p>
</section>
</section>
<section id="results" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="results"><span class="header-section-number">1.4</span> Results</h2>
<p>Our unweighted model achieved a binary success rate of 83%. Moreover, our model has an absolute success rate of 62.5%. Considering the mean absolute error is 0.6, our model is providing a valuable prediction. However, our data is under predicting. Medicine is known for its inherent nature of caution.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-bordered table-condensed lightable-classic caption-top table-sm small">
<caption>Confusion matrix for our unweighted model (Multinomial prediction)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Sensitivity</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Specificity</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Pos Pred Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Neg Pred Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Precision</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Recall</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">F1</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Prevalence</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Detection Rate</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Detection Prevalence</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Balanced Accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Class: 0</td>
<td style="text-align: left;">0.80</td>
<td style="text-align: left;">0.88</td>
<td style="text-align: left;">0.88</td>
<td style="text-align: left;">0.79</td>
<td style="text-align: left;">0.88</td>
<td style="text-align: left;">0.80</td>
<td style="text-align: left;">0.84</td>
<td style="text-align: left;">0.53</td>
<td style="text-align: left;">0.42</td>
<td style="text-align: left;">0.48</td>
<td style="text-align: left;">0.84</td>
</tr>
<tr class="even">
<td style="text-align: left;">Class: 1</td>
<td style="text-align: left;">0.45</td>
<td style="text-align: left;">0.87</td>
<td style="text-align: left;">0.67</td>
<td style="text-align: left;">0.73</td>
<td style="text-align: left;">0.67</td>
<td style="text-align: left;">0.45</td>
<td style="text-align: left;">0.54</td>
<td style="text-align: left;">0.37</td>
<td style="text-align: left;">0.17</td>
<td style="text-align: left;">0.25</td>
<td style="text-align: left;">0.66</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Class: 2</td>
<td style="text-align: left;">0.25</td>
<td style="text-align: left;">0.90</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">0.97</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">0.25</td>
<td style="text-align: left;">0.12</td>
<td style="text-align: left;">0.03</td>
<td style="text-align: left;">0.01</td>
<td style="text-align: left;">0.11</td>
<td style="text-align: left;">0.57</td>
</tr>
<tr class="even">
<td style="text-align: left;">Class: 3</td>
<td style="text-align: left;">0.25</td>
<td style="text-align: left;">0.88</td>
<td style="text-align: left;">0.12</td>
<td style="text-align: left;">0.94</td>
<td style="text-align: left;">0.12</td>
<td style="text-align: left;">0.25</td>
<td style="text-align: left;">0.17</td>
<td style="text-align: left;">0.07</td>
<td style="text-align: left;">0.02</td>
<td style="text-align: left;">0.13</td>
<td style="text-align: left;">0.56</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Class: 4</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">0.98</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">0.00</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">0.00</td>
<td style="text-align: left;">0.00</td>
<td style="text-align: left;">0.03</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="table table-striped table-bordered table-condensed lightable-classic caption-top table-sm small">
<caption>Confusion matrix for our unweighted model Binomial Prediction(Healthy and Sick)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Sensitivity</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Specificity</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Pos Pred Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Neg Pred Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Precision</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Recall</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">F1</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Prevalence</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Detection Rate</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Detection Prevalence</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Balanced Accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0.8</td>
<td style="text-align: left;">0.88</td>
<td style="text-align: left;">0.88</td>
<td style="text-align: left;">0.79</td>
<td style="text-align: left;">0.88</td>
<td style="text-align: left;">0.8</td>
<td style="text-align: left;">0.84</td>
<td style="text-align: left;">0.53</td>
<td style="text-align: left;">0.42</td>
<td style="text-align: left;">0.48</td>
<td style="text-align: left;">0.84</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We applied a Bayesian-method-inspired weighting strategy. By considering the cost of missing a diagnosis and the prevalence of rare cases, we aligned our model closer to clinical safety. By applying a cube-root inverse prevalence factor, we achieved a 49% reduction in systemic bias (from -0.33 to -0.17) and a binary accuracy rate of 84.2%, while this resulted in an 8% decrease in the absolute success rate. This trade-off enhances our model’s sensitivity.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-bordered table-condensed lightable-classic caption-top table-sm small">
<caption>Confusion matrix for our weighted model (Multinomial prediction)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Sensitivity</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Specificity</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Pos Pred Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Neg Pred Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Precision</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Recall</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">F1</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Prevalence</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Detection Rate</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Detection Prevalence</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Balanced Accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Class: 0</td>
<td style="text-align: left;">0.83</td>
<td style="text-align: left;">0.85</td>
<td style="text-align: left;">0.84</td>
<td style="text-align: left;">0.84</td>
<td style="text-align: left;">0.84</td>
<td style="text-align: left;">0.83</td>
<td style="text-align: left;">0.84</td>
<td style="text-align: left;">0.49</td>
<td style="text-align: left;">0.41</td>
<td style="text-align: left;">0.48</td>
<td style="text-align: left;">0.84</td>
</tr>
<tr class="even">
<td style="text-align: left;">Class: 1</td>
<td style="text-align: left;">0.38</td>
<td style="text-align: left;">0.81</td>
<td style="text-align: left;">0.50</td>
<td style="text-align: left;">0.73</td>
<td style="text-align: left;">0.50</td>
<td style="text-align: left;">0.38</td>
<td style="text-align: left;">0.43</td>
<td style="text-align: left;">0.32</td>
<td style="text-align: left;">0.12</td>
<td style="text-align: left;">0.25</td>
<td style="text-align: left;">0.60</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Class: 2</td>
<td style="text-align: left;">0.10</td>
<td style="text-align: left;">0.89</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">0.92</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">0.10</td>
<td style="text-align: left;">0.09</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">0.01</td>
<td style="text-align: left;">0.11</td>
<td style="text-align: left;">0.50</td>
</tr>
<tr class="even">
<td style="text-align: left;">Class: 3</td>
<td style="text-align: left;">0.18</td>
<td style="text-align: left;">0.87</td>
<td style="text-align: left;">0.12</td>
<td style="text-align: left;">0.91</td>
<td style="text-align: left;">0.12</td>
<td style="text-align: left;">0.18</td>
<td style="text-align: left;">0.15</td>
<td style="text-align: left;">0.09</td>
<td style="text-align: left;">0.02</td>
<td style="text-align: left;">0.13</td>
<td style="text-align: left;">0.53</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Class: 4</td>
<td style="text-align: left;">0.00</td>
<td style="text-align: left;">0.97</td>
<td style="text-align: left;">0.00</td>
<td style="text-align: left;">0.99</td>
<td style="text-align: left;">0.00</td>
<td style="text-align: left;">0.00</td>
<td style="text-align: left;">NaN</td>
<td style="text-align: left;">0.01</td>
<td style="text-align: left;">0.00</td>
<td style="text-align: left;">0.03</td>
<td style="text-align: left;">0.49</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="table table-striped table-bordered table-condensed lightable-classic caption-top table-sm small">
<caption>Confusion matrix for our weighted model Binomial Prediction(Healthy and Sick)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Sensitivity</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Specificity</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Pos Pred Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Neg Pred Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Precision</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Recall</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">F1</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Prevalence</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Detection Rate</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Detection Prevalence</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Balanced Accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0.83</td>
<td style="text-align: left;">0.85</td>
<td style="text-align: left;">0.84</td>
<td style="text-align: left;">0.84</td>
<td style="text-align: left;">0.84</td>
<td style="text-align: left;">0.83</td>
<td style="text-align: left;">0.84</td>
<td style="text-align: left;">0.49</td>
<td style="text-align: left;">0.41</td>
<td style="text-align: left;">0.48</td>
<td style="text-align: left;">0.84</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="discussion" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="discussion"><span class="header-section-number">1.5</span> Discussion</h2>
<p>This results show us that our model was poor at detecting Class 2 and Class 4 because we had too limited observations for our model to generalize the pattern.</p>
<p>The results of this study shows the inherent challenge of predicting disease severity in imbalanced medical datasets. While the model demonstrated high proficiency in binary classification, performance significantly declined when identifying specific severity stages. Specifically, the model struggled to detect Class 2 and Class 4 cases. This is primarily attributed to the limited number of observations for these categories in the test set, which restricted the model’s ability to generalize patterns for end-stage CAD.</p>
<p>These findings suggest that Partial Proportional Odds (PPO) modeling provides a flexible and statistically sound framework for CAD screening, particularly when standard assumptions like parallel lines are violated. Future refinements should focus on larger, multi-center datasets to bolster the representation of rare severity classes and further enhance the model’s predictive foresight.</p>
</section>
<section id="reference" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="reference"><span class="header-section-number">1.6</span> Reference:</h2>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>